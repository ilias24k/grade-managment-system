<!DOCTYPE html>



<html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

<head>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>


<body>

    <div class="main-content">

        {{>main passThisToView=user}}

        <div class="container pt-5 pb-5">
            <!-- Content here -->


            <form id="update-form">
                <div class="form-group">
                    <div class="row">
                        <div class="col-6">
                            <h1>General</h1>
                        </div>
                    </div>
                    <table class="table table-bordered" id="childTable3">
                        <thead class="thead-dark">
                            <tr>
                                <th scope="col">Name </th>
                                <th scope="col">Weight </th>
                                <th scope="col">Edit Weight</th>
                                <th scope="col">Low Bound</th>
                                <th scope="col">Edit Bound</th>

                            </tr>
                            <tr>

                                <th scope="row">Theory</th>
                                <td>{{generalTheoryWeight}} </td>
                                <td> <input type="text" id="generalTheoryWeightInput" class="form-control3"> </td>
                                <td> {{lowTheoryBound}}</td>
                                <td> <input type="text" id="lowTheoryBoundInput" class="form-control4"> </td>

                            </tr>
                            <tr>
                                <th scope="row">Lab</th>
                                <td>{{generalLabWeight}} </td>
                                <td> <input type="text" id="generalLabWeightInput" class="form-control5"> </td>
                                <td> {{lowLabBound}}</td>
                                <td> <input type="text" id="lowLabBoundInput" class="form-control6"> </td>
                            </tr>
                        </thead>
                        <tbody>

                    </table>

                    <body>
                        <div class="row">
                            <div class="col-6">
                                <h1>Theory</h1>
                            </div>
                        </div>
                        <table class="table table-bordered" id="childTable">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col">Id </th>
                                    <th scope="col">name </th>
                                    <th scope="col">weight</th>
                                    <th scope="col">bound</th>
                                    <th scope="col">edit bound</th>
                                    <th scope="col" class="text-end">action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each arr}}

                                <tr>
                                    <td>{{id}} <class="form-control1">
                                            </class>
                                    </td>
                                    <td>{{name}} <id="theoryName" class="form-control1">
                                    </td>
                                    <td>{{weight}} <id="theoryWeight" class="form-control1">
                                    </td>
                                    <td>{{bound}} <id="theoryBound" class="form-control1">
                                    </td>
                                    <td> <input type="text" id="boundTh" class="form-control7"> </td>
                                    <td class="text-end">
                                        <button <button class="btn btn-outline-danger"><i class="bi bi-x"></i>
                                            <i onclick="sent('{{name}}', {{id}}, {{weight}})">Delete</button>
                                    </td>

                                </tr>
                                {{/each}}
                        </table>
                        <button id="s1" type="button" onclick='childrenRow();' class="btn btn-outline-primary"><i
                                class="bi bi-plus"></i><i>Add Row</button>
                        <div class="col-6">
                            <h1>Lab</h1>
                        </div>

                        <table class="table table-bordered" id="childTable2">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col">Id </th>
                                    <th scope="col">name </th>
                                    <th scope="col">weight</th>
                                    <th scope="col">bound</th>
                                    <th scope="col">edit bound</th>
                                    <th scope="col" class="text-end">action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each arr2}}
                                <tr>
                                    <td>{{id}} <class="form-control2">
                                            </class>
                                    </td>
                                    <td>{{name}} <id="labName" class="form-control2">
                                    </td>
                                    <td>{{weight}} <id="labWeight" class="form-control2">
                                    </td>
                                    <td>{{bound}} <id="labBound" class="form-control1">
                                    </td>
                                    <td> <input type="text" id="boundLab" class="form-control8">
                                    <td class="text-end">
                                        <button class="btn btn-outline-danger"><i class="bi bi-x"></i>
                                            <i onclick="sent2('{{name}}', {{id}}, {{weight}})">Delete
                                        </button>
                                    </td>
                                </tr>
                                {{/each}}
                        </table>
                        <button id="s1" type="button" onclick='childrenRow2();' class="btn btn-outline-primary"><i
                                class="bi bi-plus"></i><i>Add Row</button>
                </div>

                <button type="submit" class="btn btn-primary">Submit</button>
            </form>

            <script>
                const theoryName = document.getElementsByClassName('.theory-name')
                const theoryWeight = document.querySelector('#theoryWeight')
                const labName = document.querySelector('#labName')
                const labWeight = document.querySelector('#labWeight')
                var ids = []
                var idsLab = []
                var i = 0;

                function childrenRow() {

                    var rowCount = $('#childTable tr').length;
                    ids.push(rowCount);

                    $('#childTable').find('tbody').append('<tr><th scope="row">' + rowCount
                        + '</th><td class="col-sm-4"><input type="text" name="name" class="form-control1" /></td><td><input type="text" name="weight" class="form-control1" /></tr>');
                }
                function childrenRow2() {
                    var rowCount = $('#childTable2 tr').length;
                    idsLab.push(rowCount);
                    $('#childTable2').find('tbody').append('<tr><th scope="row">' + rowCount
                        + '</th><td class="col-sm-4"><input type="text" name="name" class="form-control2" /></td><td><input type="text" name="weight" class="form-control2" /></tr>');
                }

                $("#update-form").submit(function (e) {
                    e.preventDefault();
                    var data = {}
                    var theory = []
                    var lab = []
                    var editGeneralTheoryWeight
                    var editGeneralLabWeight
                    var editGeneralTheoryBound
                    var editGeneralLabBound
                    var boundTh = []
                    var boundLab = []
                    var boundIds
                    var boundIdsLab
                  
                    $('#childTable tbody tr').each(function (row, tr) {

                        boundTh.push({
                            emp_id: $(tr).find('td:eq(0)').text(),
                            input_val: $(tr).find('input').val()
                        });

                    });
                    $('#childTable2 tbody tr').each(function (row, tr) {

                        boundLab.push({
                            emp_id: $(tr).find('td:eq(0)').text(),
                            input_val: $(tr).find('input').val()
                        });

                    });

                    $('.form-control1').each(function () {

                        var textVal = $(this).val();
                        if (textVal != 0) {
                            theory.push(textVal)
                        }

                    });

                    var counter = 0;

                    for (var x = 0; x < ids.length; x++) {
                        theory.splice(counter, 0, ids[x])
                        counter = counter + 3
                    }

                    $('.form-control2').each(function () {
                        var textVal2 = $(this).val();
                        if (textVal2 != 0) {
                            lab.push(textVal2)
                        }
                    });

                    $('.form-control3').each(function () {
                        var textVal3 = $(this).val();
                        
                        if (textVal3 !== undefined && textVal3 !== '') {
                            editGeneralTheoryWeight = textVal3

                        } else if (textVal3 === null) {
                            editGeneralTheoryWeight = 0

                        }
                    });

                    $('.form-control4').each(function () {
                        var textVal4 = $(this).val();
                        if (textVal4 != 0) {
                            editGeneralTheoryBound = textVal4
                        }
                    });
                    $('.form-control5').each(function () {
                        var textVal5 = $(this).val();
                        if (textVal5 !== undefined && textVal5 !== '') {
                            editGeneralLabWeight = textVal5
                        } else if (textVal5 === null) {
                            editGeneralLabWeight = 0
                        }
                    });
                    $('.form-control6').each(function () {
                        var textVal6 = $(this).val();
                        if (textVal6 != 0) {
                            editGeneralLabBound = textVal6
                        }
                    });
                    $('.form-control7').each(function () {
                        var textVal7 = $(this).val();
                        if (textVal7 !== undefined && textVal7 !== '') {
                            boundTh.push(textVal7)
                        } else if (textVal7 === null) {
                            boundTh.push(0)
                        }
                    });
                    $('.form-control8').each(function () {
                        var textVal8 = $(this).val();
                        if (textVal8 !== undefined && textVal8 !== '') {
                            boundLab.push(textVal8)
                        } else if (textVal8 === null) {
                            boundLab.push(0)
                        }
                    });


                    var counterLab = 0;
                    for (var x = 0; x < idsLab.length; x++) {
                        lab.splice(counterLab, 0, idsLab[x])
                        counterLab = counterLab + 3
                    }

                    if (lab.length == 0 && document.getElementById("childTable2").rows.length == 0) {//no lab and no general
                        data = { theory, editGeneralTheoryWeight, editGeneralLabWeight, boundTh, boundLab }
                    } else {
                        data = { theory, lab, editGeneralTheoryWeight, editGeneralLabWeight, editGeneralTheoryBound, editGeneralLabBound, boundTh, boundLab } //all
                    }
                    
                    $.ajax({
                        url: window.location.pathname,
                        type: "PATCH",
                        data: (data),
                        success: function (data) {
                            if (data.result == 'redirect') {
                                //redirecting to main page from here.
                                window.location.replace(data.url);
                            }
                        }
                    });

                });

            </script>

            <script>
                function sent(name, id, weight) {

                    var currentCourse = window.location.pathname.split("/").pop()

                    $.ajax({
                        url: '/course/edit/delete/' + name + '$' + id + '!' + weight + '&' + currentCourse,
                        type: 'PATCH',
                        success: function (data) {
                            if (data.result == 'redirect') {
                                //redirecting to main page from here.
                                window.location.replace(data.url);
                            }
                        }
                    })
                }
                function sent2(name, id, weight) {

                    var currentCourse = window.location.pathname.split("/").pop()

                    $.ajax({
                        url: '/course/edit/deleteLab/' + name + '$' + id + '!' + weight + '&' + currentCourse,
                        type: 'PATCH',
                        success: function (data) {
                            if (data.result == 'redirect') {
                                //redirecting to main page from here.
                                window.location.replace(data.url);
                            }
                        }
                    })
                }
            </script>

</body>
</div>

</div>

</body>

</head>

</html>